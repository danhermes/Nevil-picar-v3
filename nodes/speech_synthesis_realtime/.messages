# Speech Synthesis Node22 Message Configuration
# Converts text to speech using OpenAI Realtime API streaming TTS
# ⚠️ CRITICAL: Uses robot_hat.Music() playback (EXACT v3.0)

node_name: "speech_synthesis_realtime"
version: "2.2"
description: "Streaming TTS via OpenAI Realtime API with robot_hat.Music() playback"

# Topics this node publishes to
publishes:
  - topic: "speaking_status"
    message_type: "SpeakingStatus"
    description: "Current speech synthesis status"
    frequency: "on_change"
    schema:
      speaking:
        type: "boolean"
        required: true
        description: "True if currently speaking"
      text:
        type: "string"
        required: false
        description: "Text being spoken"
        max_length: 1000
      voice:
        type: "string"
        required: false
        description: "Voice being used"
      progress:
        type: "float"
        required: false
        description: "Speech progress (0.0 to 1.0)"
        min: 0.0
        max: 1.0
      timestamp:
        type: "float"
        required: true
        description: "Unix timestamp"

  - topic: "audio_output_status"
    message_type: "AudioOutputStatus"
    description: "Audio output device status"
    frequency: "on_change"
    schema:
      available:
        type: "boolean"
        required: true
        description: "True if audio output is available"
      device:
        type: "string"
        required: false
        description: "Audio output device name"
      volume:
        type: "float"
        required: false
        description: "Current volume (0.0 to 1.0)"
        min: 0.0
        max: 1.0

  - topic: "robot_action"
    message_type: "RobotAction"
    description: "Gesture actions synchronized with speech"
    frequency: "on_speech"
    schema:
      actions:
        type: "array"
        required: true
        description: "List of gesture actions to perform"
      source_text:
        type: "string"
        required: false
        description: "Text that triggered the gestures"
      mood:
        type: "string"
        required: false
        description: "Mood context for gestures"
      priority:
        type: "integer"
        required: false
        description: "Action priority"
      timestamp:
        type: "float"
        required: true
        description: "Unix timestamp"

# Topics this node subscribes to
subscribes:
  - topic: "text_response"
    message_type: "TextResponse"
    callback: "on_text_response"
    description: "Text to be converted to speech via Realtime API"
    schema:
      text:
        type: "string"
        required: true
        description: "Text to speak"
        max_length: 1000
      voice:
        type: "string"
        required: false
        description: "Voice to use"
        default: "echo"
        allowed: ["alloy", "echo", "shimmer", "ash", "ballad", "coral", "sage", "verse"]
      conversation_id:
        type: "string"
        required: false
        description: "Conversation ID for logging"
      timestamp:
        type: "float"
        required: true
        description: "Unix timestamp"

  - topic: "tts_request"
    message_type: "TtsRequest"
    callback: "on_tts_request"
    description: "Direct TTS requests (e.g., announcements, shutdown messages)"
    schema:
      text:
        type: "string"
        required: true
        description: "Text to speak"
      priority:
        type: "integer"
        required: false
        description: "Priority (1=highest)"
        default: 50

  - topic: "system_mode"
    message_type: "SystemMode"
    callback: "on_system_mode_change"
    description: "System mode changes"
    schema:
      mode:
        type: "string"
        required: true
        allowed: ["listening", "speaking", "thinking", "idle", "error"]

  - topic: "sound_effect"
    message_type: "SoundEffect"
    callback: "on_sound_effect"
    description: "Sound effect playback requests"
    schema:
      effect:
        type: "string"
        required: true
        description: "Sound effect name"
      volume:
        type: "integer"
        required: false
        default: 100
        description: "Volume (0-100)"
      priority:
        type: "integer"
        required: false
        default: 30
        description: "Playback priority"

# Node configuration
configuration:
  # Audio output settings - v1.0 EXACT Music() usage
  audio:
    device: "system_default"  # NO device specification - use Music() defaults
    volume_db: -10           # v1.0 VOLUME_DB setting
    # NO channels, sample_rate, buffer_size - Music() handles all of this

  # TTS settings - Realtime API
  tts:
    model: "gpt-4o-realtime-preview-2024-12-17"  # Realtime API model
    default_voice: "echo"     # Realtime API voice - smooth, cool, deeper tone
    output_format: "pcm16"    # 16-bit PCM, 24kHz mono
    sample_rate: 24000        # Realtime API audio format

  # Performance settings
  performance:
    buffer_timeout: 10.0      # Max time to wait for audio chunks
    max_buffer_size: 10485760 # 10MB max audio buffer
