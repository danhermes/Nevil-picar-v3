# Navigation Node Message Configuration
# Movement and expression execution using v1.0 action_helper

node_name: "navigation"
version: "1.0"
description: "Navigation node for executing movement commands and expressions from AI responses"

# Topics this node publishes to
publishes:
  - topic: "navigation_status"
    message_type: "NavigationStatus"
    description: "Navigation execution status and feedback"
    frequency: "on_change"
    schema:
      status:
        type: "string"
        required: true
        description: "Current navigation status"
        allowed: ["idle", "executing", "completed", "error"]
      current_action:
        type: "string"
        required: false
        description: "Currently executing action"
      actions_remaining:
        type: "integer"
        required: false
        description: "Number of actions left in queue"
      timestamp:
        type: "float"
        required: true
        description: "Unix timestamp"

  - topic: "tts_request"
    message_type: "TTSRequest"
    description: "Text-to-speech requests from automatic mode"
    frequency: "on_demand"
    schema:
      text:
        type: "string"
        required: true
        description: "Text to be synthesized"
      voice:
        type: "string"
        required: false
        description: "Voice to use for synthesis"
        default: "onyx"
      priority:
        type: "integer"
        required: false
        description: "Request priority"
        default: 100

  - topic: "auto_mode_status"
    message_type: "AutoModeStatus"
    description: "Automatic mode status updates"
    frequency: "on_change"
    schema:
      active:
        type: "boolean"
        required: true
        description: "Whether auto mode is currently active"
      mood:
        type: "string"
        required: false
        description: "Current autonomous mood"
      behavior:
        type: "string"
        required: false
        description: "Current autonomous behavior"
      timestamp:
        type: "float"
        required: true
        description: "Unix timestamp"

  - topic: "sound_effect"
    message_type: "SoundEffect"
    description: "Sound effect playback requests"
    frequency: "on_demand"
    schema:
      effect:
        type: "string"
        required: true
        description: "Sound effect to play"
        allowed: ["honk", "rev_engine", "horn", "airhorn", "machinegun", "shock", "dubstep", "dubstep_bass", "reggae", "agent_theme", "ghost_laugh", "ghost_voice", "wolf_howl", "creepy_bell", "horror_hit", "inception_horn", "alien_voice", "alien_pitch", "alien_horn", "preacher"]
      volume:
        type: "integer"
        required: false
        description: "Playback volume (0-100)"
        default: 100
      priority:
        type: "integer"
        required: false
        description: "Request priority"
        default: 50

  - topic: "voice_command"
    message_type: "VoiceCommand"
    description: "Voice commands sent to AI cognition from autonomous mode"
    frequency: "on_demand"
    schema:
      text:
        type: "string"
        required: true
        description: "Command text to process"
      confidence:
        type: "float"
        required: true
        description: "Recognition confidence (1.0 for autonomous mode)"
        min: 0.0
        max: 1.0
      timestamp:
        type: "float"
        required: true
        description: "Unix timestamp"
      conversation_id:
        type: "string"
        required: false
        description: "Conversation identifier for response correlation"

  - topic: "snap_pic"
    message_type: "SnapPicRequest"
    description: "Camera snapshot requests from autonomous mode"
    frequency: "on_demand"
    schema:
      requested_by:
        type: "string"
        required: true
        description: "Node requesting the snapshot"
      timestamp:
        type: "float"
        required: true
        description: "Unix timestamp"

# Topics this node subscribes to
subscribes:
  - topic: "robot_action"
    message_type: "RobotAction"
    callback: "on_robot_action"
    description: "Movement and expression commands from AI responses"
    schema:
      actions:
        type: "array"
        required: true
        description: "List of action commands to execute"
        items:
          type: "string"
      source_text:
        type: "string"
        required: true
        description: "Original user command that triggered actions"
      mood:
        type: "string"
        required: false
        description: "Current AI mood affecting actions"
        default: "neutral"
      priority:
        type: "integer"
        required: false
        description: "Action execution priority"
        default: 100

  - topic: "mood_change"
    message_type: "MoodChange"
    callback: "on_mood_change"
    description: "AI mood changes for behavioral adaptation"
    schema:
      mood:
        type: "string"
        required: true
        description: "New AI mood state"
        allowed: ["playful", "brooding", "curious", "melancholic", "zippy", "lonely", "mischievous", "sleepy", "neutral"]
      source:
        type: "string"
        required: true
        description: "What triggered the mood change"
      context:
        type: "string"
        required: false
        description: "Additional context for mood change"

  - topic: "auto_mode_command"
    message_type: "AutoModeCommand"
    callback: "on_auto_mode_command"
    description: "Direct auto mode commands from speech recognition"
    schema:
      command:
        type: "string"
        required: true
        description: "Auto mode command to execute"
        allowed: ["start", "stop"]
      trigger:
        type: "string"
        required: true
        description: "Trigger phrase that activated the command"
      original_text:
        type: "string"
        required: true
        description: "Original speech text that contained the trigger"
      timestamp:
        type: "float"
        required: true
        description: "Unix timestamp when command was detected"

  - topic: "text_response"
    message_type: "TextResponse"
    callback: "on_text_response"
    description: "AI-generated text responses for autonomous mode correlation"
    schema:
      text:
        type: "string"
        required: true
        description: "Response text from AI"
      conversation_id:
        type: "string"
        required: false
        description: "Conversation context identifier"
      timestamp:
        type: "float"
        required: true
        description: "Unix timestamp"

# COMMENTED OUT: Using original SpeechAnimationManager (GPT gestures) instead
#  - topic: "speaking_status"
#    message_type: "SpeakingStatus"
#    callback: "on_speaking_status"
#    description: "Speech synthesis status for triggering idle animations during speech"
#    schema:
#      speaking:
#        type: "boolean"
#        required: true
#        description: "Whether Nevil is currently speaking"
#      text:
#        type: "string"
#        required: false
#        description: "Text being spoken"
#      voice:
#        type: "string"
#        required: false
#        description: "Voice being used"
#      progress:
#        type: "float"
#        required: false
#        description: "Speech progress (0.0-1.0)"
#      timestamp:
#        type: "float"
#        required: true
#        description: "Unix timestamp"

# Node configuration
configuration:
  # Movement settings
  movement:
    default_speed: 30              # Default movement speed (0-50)
    max_queue_size: 50             # Maximum actions in queue
    action_timeout: 30.0           # Max time per action sequence
    simulation_mode: false         # Force simulation mode

  # Hardware settings
  hardware:
    reset_on_start: true           # Reset servos on initialization
    reset_on_stop: true            # Reset servos on cleanup
    safe_shutdown: true            # Ensure clean hardware shutdown